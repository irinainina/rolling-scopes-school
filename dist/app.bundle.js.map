{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","canvas","document","querySelector","ctx","getContext","x1","y1","isDrawing","boxSize","sizeInput","getElementsByName","currentBoxSize","forEach","size","checked","resizeCanvas","sizeCanvas","resize","setSizeCanvas","canvasTemp","createElement","ctxTemp","canvas2All","querySelectorAll","deltaSize","width","drawImage","height","canvas2","layer","showCanvasSize","showSize","innerText","resizeInput","scale","offsetWidth","currentTool","currentToolValue","tool","input","addEventListener","Math","floor","event","offsetX","offsetY","showCoordinates","parentNode","style","opacity","window","oncontextmenu","preventDefault","stopPropagation","activeColor","prevColor","currentColor","activeColorValue","buttons","which","button","mirror","fillStyle","x","abs","y","ctrlKey","fillRect","shiftKey","getPixel","imageData","offset","data","slice","setPixel","color","colorsMatch","a","b","floodFill","fillColor","getImageData","targetColor","pixelsToCheck","length","pop","push","putImageData","eraser","clearRect","temp","canvasCopy","startLine","drawLine","x2","y2","deltaX","deltaY","signX","signY","error","error2","midPointCircle","x0","y0","pixelSet","startX","startY","midPointEllipse","widthSquared","heightSquared","j","pixelSetEllipse","squaredDiff","_startX","_startY","shape","rgbToHsl","g","h","max","min","myImageData","Image","src","toDataURL","save","translate","rotate","PI","onload","restore","changeHotkeys","hotkeyOpen","hotkeyClose","showSettings","settings","parent","target","classList","contains","remove","add","setting","lastElementChild","inform","btnHotkey","hotkeyValues","hotkeyValuesArr","hotkey","changeValue","match","toUpperCase","includes","previousElementSibling","tooltip","dataset","tools","hotkeyNames","code","settingResizeBtn","settingSaveBtn","settingImportBtn","mouseWheelHandler","e","delta","wheelDelta","offsetHeight","frameNumber","frame","index","frameStyle","frames","frameCreate","ctx2","endLine","rgbColor","hex","substring","split","join","hexToRgbA","cellColor","r1","r2","lineWidth","strokeStyle","strokeRect","deltax","deltay","toString","square","addFrame","clone","cloneNode","appendChild","addFrameButton","children","animationBackground","onmousedown","position","zIndex","onmousemove","top","pageY","offsetTop","left","moveAt","onmouseup","item","parent1","child1","firstElementChild","parent0","child0","canvasParentNode","insertBefore","layerManagementContainer","styleActiveLayer","layerPlus","addLayer","layernum","span","firstChild","createLayer","canvastempnum","url","localStorage","setItem","createCanvasTemp","drawImageActiveClickingLayer","layerActiveNum","canvasTempAll","isCanvasTemp","removeCanvasTemp","layerActive","layersLength","ctxFrame","removeChild","canvasTempToFrame","mainContainer","prevLayer","prevCanvasTemp","layerUp","nextLayer","nextElementSibling","nextCanvasTemp","layerDown","rangeFPS","layerWrapper","fullscreenElement","exitFullscreen","requestFullscreen","timer","indexImage","animationSpeed","speed","framesCanvas","ctxLayer","clearInterval","setTimeout","rangeSize","valueImageSize","framesToImages","images","canvasIn","ctxIn","imageSmoothingEnabled","ArrayBufferData","partData","buffer","gifshot","createGIF","interval","gifWidth","gifHeight","obj","image","download","arrAnimationSpeed","Array","fill","UPNG","encode","fps","frameCount","canvasUrl","file","files","reader","FileReader","contents","pixelArr","saveFps","saveSize","saveFrameCount","saveCanvasUrl","saveCanvasImage","framesParent","framesImage","importPixel","result","readAsText","readerImage","loadImageUrl","loadImage","readAsDataURL","fileContent","Blob","type","accessToken","gapi","auth2","getAuthInstance","currentUser","getAuthResponse","access_token","form","FormData","append","JSON","stringify","mimeType","fetch","method","headers","Headers","Authorization","body","onclick","this","saveFrames","framesLength","framesUrl","onchange","getItem","radioTool","setAttribute","radioResize","savedImage","clear","lastChild","imageUrl","importDataFromPiskel","layout","piskel"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","const canvas = document.querySelector('.canvas-active');\r\nconst ctx = canvas.getContext('2d');\r\nlet isDrawing = false;\r\n// x1, y1 - coordinates of start position of cursor\r\nlet x1, y1;\r\n\r\n// choice size of tool 1-4px\r\nfunction boxSize() {\r\n  const sizeInput = document.getElementsByName('size');\r\n  let currentBoxSize = 1;\r\n  sizeInput.forEach(size => {\r\n    if (size.checked) {\r\n      currentBoxSize = +size.value;\r\n    }\r\n  });\r\n  return currentBoxSize;\r\n}\r\n\r\n// choice size of canvas 32x32, 64x64, 128x128px\r\nfunction resizeCanvas() {\r\n  const resizeInput = document.getElementsByName('resize');\r\n  let sizeCanvas;\r\n\r\n  resizeInput.forEach(resize => {\r\n    if (resize.checked) {\r\n      sizeCanvas = resize.value;\r\n    }\r\n  });\r\n\r\n  return sizeCanvas;\r\n}\r\n\r\n// resize canvas and save previous image on canvas and frames\r\nfunction setSizeCanvas() {\r\n  const canvasTemp = document.createElement('canvas');\r\n  const ctxTemp = canvasTemp.getContext('2d');\r\n  const canvas2All = document.querySelectorAll('.canvas2');\r\n  const sizeCanvas = resizeCanvas();\r\n  const deltaSize = (sizeCanvas - canvas.width) / 2;\r\n\r\n  ctxTemp.drawImage(canvas, 0, 0);\r\n  canvas.width = canvas.height = sizeCanvas;\r\n  ctx.drawImage(canvasTemp, deltaSize, deltaSize);\r\n\r\n  canvas2All.forEach(canvas2 => {\r\n    ctxTemp.drawImage(canvas2, 0, 0);\r\n    canvas2.width = canvas2.height = sizeCanvas;\r\n    const ctx2 = canvas2.getContext('2d');\r\n    ctx2.drawImage(canvasTemp, deltaSize, deltaSize);\r\n  });\r\n\r\n  const layer = document.querySelector('.layer');\r\n  layer.width = layer.height = sizeCanvas;\r\n}\r\n\r\n// show information about canvas size\r\nfunction showCanvasSize() {\r\n  const showSize = document.querySelector('.canvas-size span');\r\n  let sizeCanvas = resizeCanvas();\r\n  showSize.innerText = `[${sizeCanvas}x${sizeCanvas}]`;\r\n}\r\n\r\nconst resizeInput = document.getElementsByName('resize');\r\nresizeInput.forEach(input => input.addEventListener(\"click\", setSizeCanvas));\r\nresizeInput.forEach(input => input.addEventListener(\"click\", showCanvasSize));\r\n\r\n// scale the mouse position on canvas\r\nfunction scale() {\r\n  let pos = canvas.offsetWidth / canvas.width;\r\n  return pos;\r\n}\r\n\r\n// get coordinates x1, y1 mouse on canvas\r\ncanvas.addEventListener('mousemove', () => {\r\n  let size = boxSize();\r\n  x1 = Math.floor(event.offsetX / scale() / size) * size;\r\n  y1 = Math.floor(event.offsetY / scale() / size) * size;\r\n});\r\n\r\n// show information about cursor coordinates\r\nfunction showCoordinates() {\r\n  const showCoordinates = document.querySelector('.coordinates span');\r\n  showCoordinates.parentNode.style.opacity = '1';\r\n  showCoordinates.innerText = `${x1}:${y1}`;\r\n  canvas.addEventListener('mouseleave', () => showCoordinates.parentNode.style.opacity = '0');\r\n}\r\n\r\ncanvas.addEventListener('mousemove', showCoordinates);\r\n\r\n// get current tool\r\nfunction currentTool() {\r\n  const toolInput = document.getElementsByName('tool');\r\n  let currentToolValue;\r\n  toolInput.forEach(tool => {\r\n    if (tool.checked) {\r\n      currentToolValue = tool.value;\r\n    }\r\n  });\r\n  return currentToolValue;\r\n}\r\n\r\n// disable context menu\r\nwindow.oncontextmenu = function(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    return false;\r\n};\r\n\r\n// get current color\r\nconst activeColor = document.querySelector('.active-color');\r\nconst prevColor = document.querySelector('.prev-color');\r\n\r\n// detect if the left and only the left mouse button is press\r\nfunction detectLeftButton(event) {\r\n  event = event || window.event;\r\n  if (\"buttons\" in event) {\r\n    return event.buttons == 1;\r\n  }\r\n  var button = event.which || event.button;\r\n  return button == 1;\r\n}\r\n\r\n// get current color\r\nfunction currentColor() {\r\n  let activeColorValue;\r\n  if(detectLeftButton()) {\r\n    activeColorValue = activeColor.value;\r\n  } else {\r\n    activeColorValue = prevColor.value;\r\n  }\r\n  return activeColorValue;\r\n}\r\n\r\n// change current and prev colors\r\nfunction changeColor() {\r\n  let temp;\r\n  temp = activeColor.value;\r\n  activeColor.value = prevColor.value;\r\n  prevColor.value = temp;\r\n}\r\n\r\nconst rotate = document.querySelector('.rotate');\r\nrotate.addEventListener('click', changeColor);\r\n\r\n// checked mousedown on the canvas\r\ncanvas.addEventListener('mousedown', () => {\r\n  isDrawing = true;\r\n});\r\n\r\ncanvas.addEventListener('mouseup', () => {\r\n  isDrawing = false;\r\n});\r\n\r\ncanvas.parentNode.addEventListener('mouseleave', () => {\r\n  isDrawing = false;\r\n});\r\n\r\n// drawing with mirror pen on the canvas\r\nfunction mirror(event) {\r\n  if (currentTool() !== 'mirror' || !isDrawing) return;\r\n  ctx.fillStyle = currentColor();\r\n  let size = boxSize();\r\n  const x = Math.floor(event.offsetX / scale() / size) * size;\r\n  const x1 = Math.abs(canvas.width - x - boxSize());\r\n  const y = Math.floor(event.offsetY / scale() / size) * size;\r\n\r\n  if (event.ctrlKey) {\r\n    const y1 = Math.abs(canvas.width - y - boxSize());\r\n    ctx.fillRect(x, y, size, size);\r\n    ctx.fillRect(x, y1, size, size);\r\n  } else if (event.shiftKey) {\r\n    const x1 = Math.abs(canvas.width - x - boxSize());\r\n    const y1 = Math.abs(canvas.width - y - boxSize());\r\n    ctx.fillRect(x, y, size, size);\r\n    ctx.fillRect(x1, y, size, size);\r\n    ctx.fillRect(x, y1, size, size);\r\n    ctx.fillRect(x1, y1, size, size);\r\n  } else {\r\n    ctx.fillRect(x, y, size, size);\r\n    ctx.fillRect(x1, y, size, size);\r\n  }\r\n}\r\n\r\n// fill canvas with one color\r\n//  https://stackoverflow.com/questions/53077955/how-do-i-do-flood-fill-on-the-html-canvas-in-javascript\r\nfunction getPixel(imageData, x, y) {\r\n  if (x < 0 || y < 0 || x >= imageData.width || y >= imageData.height) {\r\n    return [-1, -1, -1, -1];  // impossible color\r\n  } else {\r\n    const offset = (y * imageData.width + x) * 4;\r\n    return imageData.data.slice(offset, offset + 4);\r\n  }\r\n}\r\n\r\nfunction setPixel(imageData, x, y, color) {\r\n  const offset = (y * imageData.width + x) * 4;\r\n  imageData.data[offset + 0] = color[0];\r\n  imageData.data[offset + 1] = color[1];\r\n  imageData.data[offset + 2] = color[2];\r\n  imageData.data[offset + 3] = color[3];\r\n}\r\n\r\nfunction colorsMatch(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\r\n}\r\n\r\nfunction floodFill(ctx, x, y, fillColor) {\r\n  // read the pixels in the canvas\r\n  const imageData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n  // get the color we're filling\r\n  const targetColor = getPixel(imageData, x, y);\r\n\r\n  // check we are actually filling a different color\r\n  if (!colorsMatch(targetColor, fillColor)) {\r\n\r\n    const pixelsToCheck = [x, y];\r\n    while (pixelsToCheck.length > 0) {\r\n      const y = pixelsToCheck.pop();\r\n      const x = pixelsToCheck.pop();\r\n\r\n      const curColor = getPixel(imageData, x, y);\r\n      if (colorsMatch(curColor, targetColor)) {\r\n        setPixel(imageData, x, y, fillColor);\r\n        pixelsToCheck.push(x + 1, y);\r\n        pixelsToCheck.push(x - 1, y);\r\n        pixelsToCheck.push(x, y + 1);\r\n        pixelsToCheck.push(x, y - 1);\r\n      }\r\n    }\r\n\r\n    // put the data back\r\n    ctx.putImageData(imageData, 0, 0);\r\n  }\r\n}\r\n\r\nfunction hexToRgbA(hex){\r\n  let c = hex.substring(1).split('');\r\n  if (c.length === 3) {\r\n      c = [c[0], c[0], c[1], c[1], c[2], c[2]];\r\n  }\r\n  c = '0x' + c.join('');\r\n  return [(c>>16)&255, (c>>8)&255, c&255, 255];\r\n}\r\n\r\nfunction bucket() {\r\n  if (currentTool() !== 'bucket') return;\r\n  if (event.ctrlKey) {\r\n    ctx.fillStyle = currentColor();\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n  } else {\r\n    let rgbColor = hexToRgbA(currentColor());\r\n    floodFill(ctx, x1, y1, rgbColor);\r\n  }\r\n}\r\n\r\n// paint all pixels of the same color\r\nfunction brush(event) {\r\n  if (currentTool() !== 'brush') return;\r\n  ctx.fillStyle = currentColor();\r\n  // determine color pixel under mouse\r\n  let x = event.offsetX / scale();\r\n  let y = event.offsetY / scale();\r\n  let cellColor = ctx.getImageData(x, y, 1, 1).data.join(',');\r\n\r\n  let width = canvas.width;\r\n  for (let i = 0; i < width; i++) {\r\n    for (let j = 0; j < width; j++) {\r\n      if (ctx.getImageData(i, j, 1, 1).data.join(',') === cellColor) {\r\n        ctx.fillRect(i, j, 1, 1)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// erasing canvas\r\nfunction eraser(event) {\r\n  if (currentTool() !== 'eraser' || !isDrawing) return;\r\n  let size = boxSize();\r\n  const x = Math.floor(event.offsetX / scale() / size) * size;\r\n  const y = Math.floor(event.offsetY / scale() / size) * size;\r\n  if (event.ctrlKey) {\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  } else {\r\n    ctx.clearRect(x, y, size, size);\r\n  }\r\n}\r\n\r\n// drawing line\r\n// https://ru.wikipedia.org/wiki/Алгоритм_Брезенхэма\r\nlet canvasCopy = canvas;\r\nconst startLine = {};\r\n\r\ncanvas.addEventListener('mousedown', () => {\r\n  ctx.fillStyle = currentColor();\r\n  canvasCopy = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n  startLine.x = x1;\r\n  startLine.y = y1;\r\n});\r\n\r\nfunction drawLine(x1, y1, x2, y2) {\r\n  let size = boxSize();\r\n  let deltaX = Math.abs(x2 - x1);\r\n  let deltaY = Math.abs(y2 - y1);\r\n  let signX = x1 < x2 ? 1 : -1;\r\n  let signY = y1 < y2 ? 1 : -1;\r\n  let error = deltaX - deltaY;\r\n  ctx.fillRect(x2, y2, size, size);\r\n  while (x1 != x2 || y1 != y2) {\r\n    ctx.fillRect(x1, y1, size, size);\r\n    let error2 = error * 2;\r\n    if (error2 > -deltaY) {\r\n      error -= deltaY;\r\n      x1 += signX;\r\n    }\r\n    if (error2 < deltaX) {\r\n      error += deltaX;\r\n      y1 += signY;\r\n    }\r\n  }\r\n}\r\n\r\nfunction stroke(event) {\r\n  if (currentTool() !== 'stroke' || !isDrawing) return;\r\n  ctx.putImageData(canvasCopy, 0, 0);\r\n  const endLine = {};\r\n  endLine.x = Math.floor(event.offsetX / scale() / boxSize()) * boxSize();\r\n  endLine.y = Math.floor(event.offsetY / scale() / boxSize()) * boxSize();\r\n  drawLine(startLine.x, startLine.y, endLine.x, endLine.y);\r\n}\r\n\r\n// drawing with pen on the canvas\r\nfunction pen(event) {\r\n  if (currentTool() !== 'pen' || !isDrawing) return;\r\n  const endLine = {};\r\n  endLine.x = Math.floor(event.offsetX / scale() / boxSize()) * boxSize();\r\n  endLine.y = Math.floor(event.offsetY / scale() / boxSize()) * boxSize();\r\n  drawLine(startLine.x, startLine.y, endLine.x, endLine.y);\r\n  startLine.x = endLine.x;\r\n  startLine.y = endLine.y;\r\n}\r\n\r\n// drawing rectangle\r\nfunction rectangle(event) {\r\n  if (currentTool() !== 'rectangle' || !isDrawing) return;\r\n  ctx.putImageData(canvasCopy, 0, 0);\r\n  ctx.lineWidth = boxSize();\r\n  ctx.strokeStyle = currentColor();\r\n  let x2 = Math.floor(event.offsetX / scale());\r\n  let y2 = Math.floor(event.offsetY / scale());\r\n\r\n  let width = x2 - startLine.x;\r\n  let height = y2 - startLine.y;\r\n\r\n  if (event.shiftKey) {\r\n    if(Math.abs(width) < Math.abs(height)) {\r\n      if(height > 0) {\r\n        height = Math.abs(width);\r\n      } else {\r\n        height = -Math.abs(width);\r\n      }\r\n    } else if(Math.abs(height) < Math.abs(width)) {\r\n      if(width > 0) {\r\n        width = Math.abs(height);\r\n      } else {\r\n        width = -Math.abs(height);\r\n      }\r\n    }\r\n  }\r\n  if (boxSize() === 1 || boxSize() === 3) {\r\n    ctx.strokeRect(startLine.x + 0.5, startLine.y + 0.5, width, height);\r\n  } else {\r\n    ctx.strokeRect(startLine.x, startLine.y, width, height);\r\n  }\r\n}\r\n\r\n// drawing circle and ellipse\r\n//Midpoint Algorithm for Circle\r\n// https://github.com/asbeane/midpointAlgorithm\r\nfunction midPointCircle(x0, y0, r) {\r\n  var x = r;\r\n  var y = 0;\r\n\r\n  var error = 1 - x;\r\n  while (x >= y) {\r\n    pixelSet(x, y, x0, y0);\r\n    y = y + 1;\r\n    if (error < 0) {\r\n      error += y * 2 + 1;\r\n    } else {\r\n      x--;\r\n      error += 2 * (y - x) + 1;\r\n    }\r\n    pixelSet(x, y, x0, y0);\r\n  }\r\n}\r\n\r\n//Circle Helper\r\nfunction pixelSet(x, y, startX, startY) {\r\n  ctx.fillRect(x + startX, y + startY, 1, 1);\r\n  ctx.fillRect(startX + y, x + startY, 1, 1);\r\n  ctx.fillRect(startX - x, startY + y, 1, 1);\r\n  ctx.fillRect(startX - y, startY + x, 1, 1);\r\n  ctx.fillRect(startX - x, startY - y, 1, 1);\r\n  ctx.fillRect(startX - y, startY - x, 1, 1);\r\n  ctx.fillRect(x + startX, startY - y, 1, 1);\r\n  ctx.fillRect(startX + y, startY - x, 1, 1);\r\n}\r\n\r\n//Mid point Algorithm for ellipse\r\nfunction midPointEllipse(x0, y0, width, height) {\r\n  var x = 0;\r\n  var y = height;\r\n  var widthSquared = width * width;\r\n  var heightSquared = height * height;\r\n\r\n  var i = 0;\r\n  var j = 2 * widthSquared * y;\r\n  pixelSetEllipse(x, y, x0, y0);\r\n  var squaredDiff = heightSquared - (widthSquared * height) + (0.25 * widthSquared);\r\n\r\n  while (i < j) {\r\n    x++;\r\n    i = i + 2 * heightSquared;\r\n    if (squaredDiff < 0) {\r\n      squaredDiff = squaredDiff + heightSquared + i;\r\n    } else {\r\n      y--;\r\n      j = j - 2 * widthSquared;\r\n      squaredDiff = squaredDiff + heightSquared + i - j;\r\n    }\r\n    pixelSetEllipse(x, y, x0, y0);\r\n  }\r\n\r\n  squaredDiff = heightSquared * ((x + 0.5) * (x + 0.5)) + widthSquared * ((y - 1) * (y - 1)) - widthSquared * heightSquared;\r\n  while (y > 0) {\r\n    y--;\r\n    j = j - 2 * widthSquared;\r\n    if (squaredDiff > 0) {\r\n      squaredDiff = squaredDiff + widthSquared - j;\r\n    } else {\r\n      x++;\r\n      i = i + 2 * heightSquared;\r\n      squaredDiff = squaredDiff + widthSquared - j + i;\r\n    }\r\n    pixelSetEllipse(x, y, x0, y0);\r\n  }\r\n}\r\n\r\n//Ellipse Helper\r\nfunction pixelSetEllipse(x, y, _startX, _startY) {\r\n  ctx.fillRect(_startX + x, _startY + y, 1, 1);\r\n  ctx.fillRect(_startX - x, _startY + y, 1, 1);\r\n  ctx.fillRect(_startX + x, _startY - y, 1, 1);\r\n  ctx.fillRect(_startX - x, _startY - y, 1, 1);\r\n}\r\n\r\nfunction circle(event) {\r\n  if (currentTool() !== 'circle' || !isDrawing) return;\r\n  ctx.putImageData(canvasCopy, 0, 0);\r\n  ctx.fillStyle = currentColor();\r\n  const endLine = {};\r\n  endLine.x = Math.floor(event.offsetX / scale() / boxSize()) * boxSize();\r\n  endLine.y = Math.floor(event.offsetY / scale() / boxSize()) * boxSize();\r\n  let r;\r\n  let r1 = Math.floor(Math.abs(endLine.x - startLine.x) / 2);\r\n  let r2 = Math.floor(Math.abs(endLine.y - startLine.y) / 2);\r\n  r1 < r2 ? r = r1 : r = r2;\r\n  if(startLine.x < endLine.x && startLine.y < endLine.y) {\r\n    if (event.shiftKey) {\r\n      midPointCircle(x1 - r, y1 - r, r);\r\n    } else {\r\n      midPointEllipse(x1 - r1, y1 - r2, r1, r2);\r\n    }\r\n  } else if(startLine.x > endLine.x && startLine.y > endLine.y) {\r\n    if (event.shiftKey) {\r\n      midPointCircle(startLine.x - r, startLine.y - r, r);\r\n    } else {\r\n      midPointEllipse(startLine.x - r1, startLine.y - r2, r1, r2);\r\n    }\r\n  }  else if (startLine.x < endLine.x && startLine.y > endLine.y) {\r\n    if (event.shiftKey) {\r\n        midPointCircle(x1 - r, startLine.y - r, r);\r\n      } else {\r\n        midPointEllipse(x1 - r1, startLine.y - r2, r1, r2);\r\n      }\r\n  } else if (startLine.x > endLine.x && startLine.y < endLine.y) {\r\n    if (event.shiftKey) {\r\n        midPointCircle(startLine.x - r, y1 - r, r);\r\n      } else {\r\n        midPointEllipse(startLine.x - r1, y1 - r2, r1, r2);\r\n      }\r\n  }\r\n}\r\n\r\n// move canvas\r\nfunction move() {\r\n  if (currentTool() !== 'move' || !isDrawing) return;\r\n  ctx.putImageData(canvasCopy, 0, 0);\r\n  let deltax = x1 - startLine.x;\r\n  let deltay = y1 - startLine.y;\r\n  let imageData = ctx.getImageData(0, 0, canvas.width - deltax, canvas.height - deltay);\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  ctx.putImageData(imageData, deltax, deltay);\r\n}\r\n\r\n// selection canvas area with same color\r\nfunction shape() {\r\n  if (currentTool() !== 'shape' || !isDrawing) return;\r\n  ctx.putImageData(canvasCopy, 0, 0);\r\n  const rgbColor = [79, 181, 227, 115];\r\n  floodFill(ctx, x1, y1, rgbColor);\r\n  let imageData = ctx.getImageData(startLine.x, startLine.y, canvas.width, canvas.height);\r\n  ctx.putImageData(imageData, x2, y2);\r\n}\r\n\r\n// rotation canvas\r\n// http://qaru.site/questions/6704867/rotate-canvas-90-degrees-clockwise-and-update-width-height\r\nfunction rotation(event) {\r\n  const myImageData = new Image();\r\n  myImageData.src = canvas.toDataURL();\r\n  ctx.save();\r\n  if (event.ctrlKey) {\r\n    ctx.translate(canvas.width, 1);\r\n    ctx.rotate(Math.PI / 2);\r\n  } else {\r\n    ctx.translate(1, canvas.width);\r\n    ctx.rotate(3 * Math.PI / 2);\r\n  }\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  myImageData.onload = function() {\r\n    ctx.drawImage(myImageData, 0, 0);\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\nconst rotationButton = document.querySelector('.rotation');\r\nrotationButton.addEventListener('mousedown', rotation);\r\n\r\n// flipflop\r\nfunction flipflop(event) {\r\n  const myImageData = new Image();\r\n  myImageData.src = canvas.toDataURL();\r\n  ctx.save();\r\n  if(event.ctrlKey) {\r\n    ctx.translate(0, canvas.width);\r\n    ctx.scale(1, -1);\r\n  } else {\r\n    ctx.translate(canvas.width, 0);\r\n    ctx.scale(-1, 1);\r\n  }\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  myImageData.onload = function() {\r\n    ctx.drawImage(myImageData, 0, 0);\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\nconst flipflopButton = document.querySelector('.flipflop');\r\nflipflopButton.addEventListener('mousedown', flipflop);\r\n\r\n// dithering - fill color each even pixel as chess board\r\nfunction dithering(event) {\r\n  if (currentTool() !== 'dithering' || !isDrawing) return;\r\n  const prevColor = document.querySelector('.prev-color');\r\n  let square = boxSize();\r\n  const x = Math.floor(event.offsetX / scale());\r\n  const y = Math.floor(event.offsetY / scale());\r\n  if (event.ctrlKey) {\r\n      for(let x1 = x; x1 < x + square; x1++) {\r\n        for(let y1 = y; y1 < y + square; y1++) {\r\n          if(x1 % 2 !== y1 % 2) {\r\n            ctx.fillStyle = currentColor();\r\n            ctx.fillRect(x1, y1, 1, 1);\r\n          } else {\r\n            ctx.fillStyle = prevColor.value;\r\n            ctx.fillRect(x1, y1, 1, 1);\r\n          }\r\n        }\r\n      }\r\n  } else {\r\n      for(let x1 = x; x1 < x + square; x1++) {\r\n        for(let y1 = y; y1 < y + square; y1++) {\r\n          if(x1 % 2 !== y1 % 2) {\r\n            ctx.fillStyle = currentColor();\r\n            ctx.fillRect(x1, y1, 1, 1);\r\n          } else {\r\n            ctx.clearRect(x1, y1, 1, 1);\r\n          }\r\n        }\r\n      }\r\n  }\r\n}\r\n\r\n// helper for function lighten\r\n// https://gist.github.com/mjackson/5311256\r\nfunction rgbToHsl(r, g, b) {\r\n  r /= 255, g /= 255, b /= 255;\r\n  let max = Math.max(r, g, b), min = Math.min(r, g, b);\r\n  let h, s, l = (max + min) / 2;\r\n  if (max == min) {\r\n    h = s = 0; // achromatic\r\n  } else {\r\n    let d = max - min;\r\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n    switch (max) {\r\n      case r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n      case g: h = (b - r) / d + 2; break;\r\n      case b: h = (r - g) / d + 4; break;\r\n    }\r\n    h /= 6;\r\n  }\r\n  return [ h * 360, s * 100, l * 100 ];\r\n}\r\n\r\n// lighten - set color lighter or darker\r\nfunction lighten(event) {\r\n  if (currentTool() !== 'lighten' || !isDrawing) return;\r\n  let square = boxSize();\r\n\r\n  for(let x2 = x1; x2 < x1 + square; x2++) {\r\n    for(let y2 = y1; y2 < y1 + square; y2++) {\r\n      let pixel = ctx.getImageData(x2, y2, 1, 1);\r\n      let data = pixel.data;\r\n\r\n      // if color transparent\r\n      if (data[3] === 0) return;\r\n      let [h, s, l] = rgbToHsl(data[0], data[1], data[2]);\r\n\r\n      if (event.ctrlKey) {\r\n        ctx.fillStyle = `hsl(${h}, ${s}%, ${l > 6 ? l -=5 : 1}%)`;\r\n\r\n      } else {\r\n        ctx.fillStyle = `hsl(${h}, ${s}%, ${l < 94 ? l +=5 : 99}%)`;\r\n      }\r\n      ctx.fillRect(x2, y2, 1, 1);\r\n    }\r\n  }\r\n}\r\n\r\n// color picker - get color of pixel on canvas\r\nfunction colorPicker() {\r\n  if (currentTool() !== 'color-picker' || !isDrawing) return;\r\n  const x1 = Math.floor(event.offsetX / scale());\r\n  const y1 = Math.floor(event.offsetY / scale());\r\n  let pixel = ctx.getImageData(x1, y1, 1, 1);\r\n  let data = pixel.data;\r\n  // if color transparent\r\n  if (data[3] === 0) return;\r\n  let r = data[0].toString(16);\r\n  r = r.length === 1 ? \"0\" + r : r;\r\n  let g = data[1].toString(16);\r\n  g = g.length === 1 ? \"0\" + g : g;\r\n  let b = data[2].toString(16);\r\n  b = b.length === 1 ? \"0\" + b : b;\r\n  let hex = `#${r}${g}${b}`;\r\n  activeColor.value = hex;\r\n}\r\n\r\n// key activation tools\r\nfunction hotKey(event) {\r\n  const tools = document.querySelector('.tools');\r\n  const hotkeyValues = document.querySelectorAll('.hotkey-value');\r\n  const hotkeyNames = document.querySelectorAll('.hotkey-name');\r\n  for(let i = 0; i < hotkeyValues.length; i++) {\r\n    if (event.code === `Key${hotkeyValues[i].innerText}`) {\r\n    tools.querySelector(`input[value=${hotkeyNames[i].innerText}]`).checked = true;\r\n    }\r\n  }\r\n}\r\n\r\n// modal window to change keyboard shortcuts\r\nconst changeHotkeys = document.querySelector('.change-hotkeys');\r\nconst hotkeyOpen = document.querySelector('.change-hotkey');\r\nconst hotkeyClose = document.querySelector('.cancel');\r\n\r\nfunction changeShortcuts(event) {\r\n  if(!event.target.classList.contains('hotkey-input')) return;\r\n\r\n  const inform = document.querySelector('.inform');\r\n  const btnHotkey = document.querySelector('.btn-hotkey');\r\n  const hotkeyValues = document.querySelectorAll('.hotkey-value');\r\n  const hotkeyValuesArr = [];\r\n  hotkeyValues.forEach(hotkey => hotkeyValuesArr.push(hotkey.innerText));\r\n\r\n  event.target.addEventListener('input', () => {\r\n    let changeValue = event.target.value;\r\n    if (!changeValue.match(/[a-zA-Z]/)) {\r\n      inform.innerText = \"Please use only Latin letters\";\r\n    }\r\n    if (changeValue.match(/[a-z]/)) {\r\n      changeValue = changeValue.toUpperCase();\r\n    }\r\n    if (hotkeyValuesArr.includes(changeValue)) {\r\n      inform.innerText = \"This letter already in use. Please choose another letter\";\r\n    } else if(changeValue.match(/[A-Z]/)) {\r\n      inform.innerText = \"Press the button to change the hotkey\";\r\n    }\r\n    btnHotkey.addEventListener('click', () => {\r\n      event.target.previousElementSibling.innerText = changeValue;\r\n      event.target.value = '';\r\n      inform.innerText = \"The hotkey is changed successfully\";\r\n\r\n      const tooltipShortcuts = document.querySelectorAll('.tooltip-shortcut');\r\n      tooltipShortcuts.forEach(tooltip => {\r\n        if(tooltip.dataset.tool === event.target.previousElementSibling.previousElementSibling.innerText) {\r\n          tooltip.innerText = `(${changeValue})`;\r\n        }\r\n      })\r\n    });\r\n  });\r\n}\r\n\r\nchangeHotkeys.addEventListener('click', changeShortcuts);\r\nhotkeyOpen.addEventListener('click', () => {\r\n  changeHotkeys.classList.remove('hide');\r\n});\r\nhotkeyClose.addEventListener('click', () => {\r\n  changeHotkeys.classList.add('hide');\r\n});\r\n\r\nwindow.addEventListener('keydown', hotKey);\r\n\r\n// show and hide modal window with settings on layout\r\nfunction showSettings(event) {\r\n  const settings = document.querySelectorAll('.setting-container');\r\n  const buttons = document.querySelectorAll('.setting-btn');\r\n  const parent = event.target.parentNode;\r\n\r\n  if (!event.target.classList.contains('btn-show')) {\r\n    buttons.forEach(button => {\r\n      button.classList.remove('btn-show');\r\n    });\r\n    event.target.classList.add('btn-show')\r\n  }\r\n\r\n  if(parent.classList.contains('setting-hide')) {\r\n    settings.forEach(setting => {\r\n      setting.classList.remove('setting-hide');\r\n    });\r\n    if (!parent.classList.contains('setting-show')) {\r\n      settings.forEach(setting => {\r\n        setting.classList.remove('setting-show');\r\n        setting.lastElementChild.classList.remove('setting-opacity');\r\n        setting.lastElementChild.classList.add('setting-none');\r\n        parent.classList.add('setting-show');\r\n        parent.lastElementChild.classList.remove('setting-none');\r\n        parent.lastElementChild.classList.add('setting-opacity');\r\n      });\r\n    }\r\n  } else if (!parent.classList.contains('setting-show')) {\r\n    settings.forEach(setting => {\r\n      setting.classList.remove('setting-show');\r\n      setting.lastElementChild.classList.remove('setting-opacity');\r\n      setting.lastElementChild.classList.add('setting-none');\r\n      parent.classList.add('setting-show');\r\n      parent.lastElementChild.classList.remove('setting-none');\r\n      parent.lastElementChild.classList.add('setting-opacity');\r\n    });\r\n  } else {\r\n    settings.forEach(setting => {\r\n      setting.classList.add('setting-hide');\r\n    });\r\n  }\r\n}\r\n\r\nconst settingResizeBtn = document.querySelector('.setting-resize-btn');\r\nconst settingSaveBtn = document.querySelector('.setting-save-btn');\r\nconst settingImportBtn = document.querySelector('.setting-import-btn');\r\n\r\nsettingResizeBtn.addEventListener('click', showSettings);\r\nsettingSaveBtn.addEventListener('click', showSettings);\r\nsettingImportBtn.addEventListener('click', showSettings);\r\n\r\n// canvas zoom in and zoom out on mousewheel\r\nfunction mouseWheelHandler(e) {\r\n  e = window.event;\r\n  let delta = Math.max(-1, Math.min(1, e.wheelDelta));\r\n  canvas.style.width = Math.max(32, Math.min(640, canvas.offsetWidth + (32 * delta))) + \"px\";\r\n  canvas.style.height = Math.max(32, Math.min(640, canvas.offsetHeight + (32 * delta))) + \"px\";\r\n  return false;\r\n}\r\n\r\nconst mainContainer = document.querySelector('.main-container');\r\nmainContainer.addEventListener('mousewheel', mouseWheelHandler);\r\ncanvas.addEventListener('mousewheel', mouseWheelHandler);\r\n\r\ncanvas.addEventListener('mousemove', pen);\r\ncanvas.addEventListener('mousedown', mirror);\r\ncanvas.addEventListener('mousemove', mirror);\r\ncanvas.addEventListener('mousedown', bucket);\r\ncanvas.addEventListener('mousedown', eraser);\r\ncanvas.addEventListener('mousemove', eraser);\r\ncanvas.addEventListener('mousedown', brush);\r\ncanvas.addEventListener('mousemove', stroke);\r\ncanvas.addEventListener('mousemove', circle);\r\ncanvas.addEventListener('mousemove', rectangle);\r\ncanvas.addEventListener('mousemove', move);\r\ncanvas.addEventListener('mousemove', shape);\r\ncanvas.addEventListener('mousedown', shape);\r\ncanvas.addEventListener('mousedown', colorPicker);\r\ncanvas.addEventListener('mousedown', lighten);\r\ncanvas.addEventListener('mousemove', dithering);\r\n\r\n// add numbers to frames\r\nfunction frameNumber() {\r\n  const frames = document.querySelectorAll('.preview');\r\n  frames.forEach((frame, index) => {\r\n    const frameNumber = frame.querySelector('.number');\r\n    frameNumber.innerText = index + 1;\r\n  });\r\n}\r\n\r\n// add style to active frame\r\nfunction frameStyle() {\r\n  const frames = document.querySelectorAll('.preview');\r\n  frames.forEach((frame, index) => {\r\n    frame.classList.remove('preview-active');\r\n    if (index === frames.length - 1) {\r\n      frame.classList.add('preview-active');\r\n    }\r\n  });\r\n}\r\n\r\n// add canvas image to active frame when mouse up\r\nfunction frameCreate() {\r\n  const frames = document.querySelectorAll('.preview');\r\n  frames.forEach((frame) => {\r\n    if (frame.classList.contains('preview-active')) {\r\n      const canvas2 = frame.querySelector('.canvas2');\r\n      const ctx2 = canvas2.getContext('2d');\r\n      ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\r\n      ctx2.drawImage(canvas, 0, 0);\r\n    }\r\n  });\r\n}\r\n\r\ncanvas.addEventListener('mouseup', frameCreate);\r\n\r\n// style active frame on click\r\nfunction frameActivation(event) {\r\n  if (event.target.classList.contains('canvas2')) {\r\n    const frames = document.querySelectorAll('.preview');\r\n    frames.forEach((frame) => {\r\n      if (frame.classList.contains('preview-active')) {\r\n        frame.classList.remove('preview-active');\r\n      }\r\n    });\r\n    event.target.parentNode.classList.add('preview-active');\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    ctx.drawImage(event.target, 0, 0);\r\n  }\r\n}\r\n\r\nconst parent = document.querySelector('.previews-list');\r\nparent.addEventListener(\"click\", frameActivation);\r\n\r\n// create new frame when click button Add frames\r\nfunction addFrame() {\r\n  const elem = parent.querySelector('.preview-container');\r\n  const clone = elem.cloneNode(true);\r\n  parent.appendChild(clone);\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  frameNumber();\r\n  frameStyle();\r\n}\r\n\r\nconst addFrameButton = document.querySelector('.add-frame');\r\naddFrameButton.addEventListener(\"click\", addFrame);\r\n\r\n// delete frame when click button delete\r\nfunction deleteFrame(event) {\r\n  if (event.target.classList.contains('delete') && parent.children.length > 1) {\r\n    if(event.target.parentNode.classList.contains('preview-active')) {\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    }\r\n    event.target.parentNode.parentNode.remove();\r\n    frameNumber();\r\n    animationBackground();\r\n    frameStyle();\r\n  }\r\n}\r\n\r\nparent.addEventListener(\"click\", deleteFrame);\r\n\r\n// move frame and swape with other frames\r\nfunction moveFrame(event) {\r\n  if (!event.target.classList.contains('move')) return;\r\n  let t = event.target.parentNode;\r\n  event.target.onmousedown = function () {\r\n    t.style.position = \"absolute\";\r\n    t.style.zIndex = 100;\r\n    t.parentNode.classList.add('preview-container-active');\r\n\r\n    function moveAt(event) {\r\n      t.style.top = event.pageY - t.offsetHeight / 2 - t.parentNode.offsetTop + 'px';\r\n      t.style.left = '-3px'\r\n    }\r\n    document.onmousemove = function (event) {\r\n      moveAt(event);\r\n    }\r\n  }\r\n  t.onmouseup = function () {\r\n    const blockContainer = document.querySelectorAll('.preview-container');\r\n    blockContainer.forEach(item => {\r\n      let y = t.offsetTop + t.parentNode.offsetTop;\r\n      let y1 = item.offsetTop;\r\n\r\n      if(y > parent.offsetHeight) {\r\n        t.parentNode.appendChild(t);\r\n        t.style.top = '0px';\r\n        t.style.left = '0px'\r\n      }\r\n\r\n      if (y > y1 - 50 && y < y1 + 50) {\r\n        let parent1 = item;\r\n        let child1 = item.firstElementChild;\r\n        let parent0 = t.parentNode;\r\n        let child0 = t;\r\n        t.style.top = '0px';\r\n        t.style.left = '0px'\r\n\r\n        parent1.appendChild(child0);\r\n        parent0.appendChild(child1);\r\n\r\n        parent0.classList.remove('preview-container-active');\r\n      } else {\r\n        t.parentNode.appendChild(t);\r\n        t.parentNode.classList.remove('preview-container-active');\r\n      }\r\n    });\r\n    t.style.zIndex = 1;\r\n\r\n    document.onmousemove = null;\r\n    t.onmouseup = null;\r\n\r\n    frameNumber();\r\n    animationBackground();\r\n    frameStyle();\r\n  }\r\n}\r\n\r\nparent.addEventListener(\"mouseover\", moveFrame);\r\n\r\n// clone frame when click button clone\r\nfunction cloneFrame(event) {\r\n  if (event.target.classList.contains('copy')) {\r\n    const clone = event.target.parentNode.parentNode.cloneNode(true);\r\n    const parentNode = event.target.parentNode.parentNode;\r\n    const canvasParentNode = event.target.parentNode.querySelector('canvas');\r\n    const canvasCloneElem = clone.querySelector('canvas');\r\n    const ctxCloneElem = canvasCloneElem.getContext('2d');\r\n    ctxCloneElem.drawImage(canvasParentNode, 0, 0);\r\n    parent.insertBefore(clone, parentNode);\r\n    frameNumber();\r\n    animationBackground();\r\n    frameStyle();\r\n  }\r\n}\r\nparent.addEventListener(\"click\", cloneFrame);\r\n\r\nconst layer = document.querySelector('.layer');\r\n\r\n// layer management\r\nconst layerManagementContainer = document.querySelector('.layer-management-layer-container');\r\n\r\n// create new layers when click add layer\r\nfunction createLayer() {\r\n  const addLayer = document.createElement('div');\r\n  addLayer.classList.add('layer-management-layer');\r\n  addLayer.innerText = 'Layer ';\r\n  addLayer.dataset.layernum = layerManagementContainer.children.length + 1;\r\n  const span = document.createElement('span');\r\n  span.innerText = `${layerManagementContainer.children.length\r\n + 1}`;\r\n  addLayer.appendChild(span);\r\n\r\n  layerManagementContainer.insertBefore(addLayer, layerManagementContainer.firstChild);\r\n}\r\n\r\n// active layer style for layer which create last\r\nfunction styleActiveLayer() {\r\n  const layerManagementLayers = document.querySelectorAll('.layer-management-layer');\r\n  layerManagementLayers.forEach(layer => {\r\n    if (layer.classList.contains('layer-management-layer-active')) {\r\n      layer.classList.remove('layer-management-layer-active');\r\n    }\r\n  });\r\n  layerManagementContainer.firstElementChild.classList.add('layer-management-layer-active');\r\n}\r\n\r\n// active layer style for clicking layer\r\nfunction styleActiveClickedLayer(event) {\r\n  const layerManagementLayers = document.querySelectorAll('.layer-management-layer');\r\n  layerManagementLayers.forEach(layer => {\r\n    if (layer.classList.contains('layer-management-layer-active')) {\r\n      layer.classList.remove('layer-management-layer-active');\r\n    }\r\n    event.target.classList.add('layer-management-layer-active');\r\n  })\r\n}\r\n\r\nlayerManagementContainer.addEventListener('click', styleActiveClickedLayer);\r\n\r\n// create additional canvas for semitransparent image\r\nfunction createCanvasTemp() {\r\n  const canvasTemp = document.createElement('canvas');\r\n  canvasTemp.width = canvasTemp.height = canvas.width;\r\n  canvasTemp.classList.add('canvas-temp');\r\n  canvasTemp.dataset.canvastempnum = layerManagementContainer.children.length - 1;\r\n  const mainContainer = document.querySelector('.main-container');\r\n  mainContainer.appendChild(canvasTemp);\r\n\r\n  const ctxTemp = canvasTemp.getContext('2d');\r\n  const myImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n  ctxTemp.putImageData(myImageData, 0, 0);\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  const url = canvas.toDataURL();\r\n  localStorage.setItem('url', url);\r\n}\r\n\r\nfunction layerPlus() {\r\n  createLayer();\r\n  styleActiveLayer();\r\n  createCanvasTemp();\r\n}\r\n\r\n// active layer drav image on canvas for clicking layer\r\nfunction drawImageActiveClickingLayer() {\r\n  const layerActive = document.querySelector('.layer-management-layer-active');\r\n  const layerActiveNum = layerActive.dataset.layernum;\r\n  const canvasTempAll = document.querySelectorAll('.canvas-temp');\r\n  isCanvasTemp = false;\r\n  canvasTempAll.forEach(canvasTemp => {\r\n    if(canvasTemp.dataset.canvastempnum == layerManagementContainer.children.length) {\r\n      isCanvasTemp = true;\r\n    }\r\n  });\r\n  if(!isCanvasTemp) {\r\n    const canvasTemp = document.createElement('canvas');\r\n    canvasTemp.width = canvasTemp.height = canvas.width;\r\n    canvasTemp.classList.add('canvas-temp');\r\n    canvasTemp.dataset.canvastempnum = layerManagementContainer.children.length;\r\n    const mainContainer = document.querySelector('.main-container');\r\n    mainContainer.appendChild(canvasTemp);\r\n\r\n    const ctxTemp = canvasTemp.getContext('2d');\r\n    const myImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    ctxTemp.putImageData(myImageData, 0, 0);\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    const url = canvas.toDataURL();\r\n    localStorage.setItem('url', url);\r\n  }\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  canvasTempAll.forEach(canvasTemp => {\r\n    if(canvasTemp.dataset.canvastempnum == layerActiveNum) {\r\n      ctx.drawImage(canvasTemp, 0, 0);\r\n    }\r\n  });\r\n}\r\n\r\nlayerManagementContainer.addEventListener('click', drawImageActiveClickingLayer);\r\n\r\n// canvas drav image on active layer\r\nfunction drawImageOnCanvasTemp() {\r\n  const layerActive = document.querySelector('.layer-management-layer-active');\r\n  const layerActiveNum = layerActive.dataset.layernum;\r\n  const layersLength = layerManagementContainer.children.length;\r\n  const canvasTempAll = document.querySelectorAll('.canvas-temp');\r\n  if(layerActiveNum == layersLength) return;\r\n  canvasTempAll.forEach(canvasTemp => {\r\n    if(canvasTemp.dataset.canvastempnum == layerActiveNum) {\r\n      const ctxTemp = canvasTemp.getContext('2d');\r\n      const myImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n      ctxTemp.putImageData(myImageData, 0, 0);\r\n    }\r\n  });\r\n}\r\n\r\ncanvas.addEventListener('mouseup', drawImageOnCanvasTemp);\r\n\r\nfunction removeCanvasTemp() {\r\n  drawImageActiveClickingLayer();\r\n  const layerActive = document.querySelector('.layer-management-layer-active');\r\n  const layersLength = layerManagementContainer.children.length;\r\n  const layerActiveNum = layerActive.dataset.layernum;\r\n  const canvasTempAll = document.querySelectorAll('.canvas-temp');\r\n  if(layersLength === 1) {\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    const url = canvas.toDataURL();\r\n    localStorage.setItem('url', url);\r\n    layerActive.firstElementChild.innerText = '1';\r\n    layerActive.dataset.layernum = '1';\r\n    canvasTempAll.forEach(canvas2 => canvas2.remove());\r\n    frameCreate();\r\n    animationBackground();\r\n    return;\r\n  }\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  layerActive.remove();\r\n    canvasTempAll.forEach(canvas2 => {\r\n      if(canvas2.dataset.canvastempnum == layerActiveNum) {\r\n        canvas2.remove();\r\n      }\r\n    });\r\n  styleActiveLayer();\r\n  drawImageActiveClickingLayer();\r\n}\r\n\r\nfunction canvasTempToFrame() {\r\n  const activeFrame = document.querySelector('.preview-active');\r\n  const currentFrame = activeFrame.parentNode.previousElementSibling;\r\n  const canvas2 = currentFrame.querySelector('.canvas2');\r\n  const ctxFrame = canvas2.getContext('2d');\r\n  const canvasTemp = document.querySelectorAll('.canvas-temp');\r\n  for(let i = 0; i < canvasTemp.length; i++) {\r\n    ctxFrame.drawImage(canvasTemp[i], 0, 0);\r\n    canvasTemp[i].remove();\r\n  }\r\n  const url = canvas2 .toDataURL();\r\n  localStorage.setItem('url', url);\r\n  while (layerManagementContainer.children.length > 1) {\r\n    layerManagementContainer.removeChild(layerManagementContainer.firstChild);\r\n  }\r\n  layerManagementContainer.firstElementChild.firstElementChild.innerText = '1';\r\n  styleActiveLayer();\r\n}\r\n\r\naddFrameButton.addEventListener(\"click\", () => {\r\n  canvasTempToFrame();\r\n  removeCanvasTemp();\r\n  styleActiveLayer();\r\n});\r\n\r\n// up layer when click btn-up\r\nfunction layerUp() {\r\n  const layerActive = document.querySelector('.layer-management-layer-active');\r\n  const layersLength = layerManagementContainer.children.length;\r\n  const layerActiveNum = layerActive.dataset.layernum;\r\n  const mainContainer = document.querySelector('.main-container');\r\n  const canvasTempAll = document.querySelectorAll('.canvas-temp');\r\n  if(layerActive === layerManagementContainer.firstElementChild) return;\r\n\r\n  const prevLayer = layerActive.previousElementSibling;\r\n  layerManagementContainer.removeChild(layerActive);\r\n  layerManagementContainer.insertBefore(layerActive, prevLayer);\r\n\r\n  canvasTempAll.forEach(canvasTemp => {\r\n    if(canvasTemp.dataset.canvastempnum == layerActiveNum) {\r\n      const prevCanvasTemp = canvasTemp.previousElementSibling;\r\n      mainContainer.removeChild(canvasTemp);\r\n      mainContainer.insertBefore(canvasTemp, prevCanvasTemp);\r\n    }\r\n  });\r\n  drawImageActiveClickingLayer();\r\n}\r\n\r\n// down layer when click btn-down\r\nfunction layerDown() {\r\n  const layerActive = document.querySelector('.layer-management-layer-active');\r\n  const layersLength = layerManagementContainer.children.length;\r\n  const layerActiveNum = layerActive.dataset.layernum;\r\n  const mainContainer = document.querySelector('.main-container');\r\n  const canvasTempAll = document.querySelectorAll('.canvas-temp');\r\n  if(layerActive === layerManagementContainer.lastElementChild) return;\r\n\r\n  const nextLayer = layerActive.nextElementSibling;\r\n  layerManagementContainer.removeChild(nextLayer);\r\n  layerManagementContainer.insertBefore(nextLayer, layerActive);\r\n\r\n  canvasTempAll.forEach(canvasTemp => {\r\n    if(canvasTemp.dataset.canvastempnum == layerActiveNum) {\r\n      const nextCanvasTemp = canvasTemp.nextElementSibling;\r\n      mainContainer.removeChild(nextCanvasTemp);\r\n      mainContainer.insertBefore(nextCanvasTemp, canvasTemp);\r\n    }\r\n  });\r\n  drawImageActiveClickingLayer();\r\n}\r\n\r\nfunction layerManagementBtnDelegation(event) {\r\n  event.stopPropagation();\r\n  if (!event.target.classList.contains('layer-management-btn')) return;\r\n  if (event.target.classList.contains('btn-plus')) {\r\n    layerPlus();\r\n  } else if (event.target.classList.contains('btn-delete')) {\r\n    removeCanvasTemp();\r\n  } else if (event.target.classList.contains('btn-up')) {\r\n    layerUp()\r\n  } else if (event.target.classList.contains('btn-down')) {\r\n    layerDown();\r\n  }\r\n}\r\n\r\nconst layerManagementBtn = document.querySelector('.layer-management-btn-container');\r\nlayerManagementBtn.addEventListener('click', layerManagementBtnDelegation);\r\n\r\n// change text on input range\r\nfunction valueFPS() {\r\n  const fpsValue = document.querySelector('.fps-value');\r\n  fpsValue.innerText = rangeFPS.value;\r\n}\r\n\r\nconst rangeFPS = document.querySelector('.range-fps');\r\nrangeFPS.addEventListener(\"input\", valueFPS);\r\n\r\n// run the animation in Full screen mode\r\nfunction toggleFullscreen() {\r\n  const layerWrapper = document.querySelector('.layer-wrapper');\r\n  if (!document.fullscreenElement) {\r\n    layerWrapper.requestFullscreen();\r\n  } else {\r\n    document.exitFullscreen();\r\n  }\r\n}\r\n\r\nconst layerBtn = document.querySelector('.layer-btn');\r\nlayerBtn.addEventListener('click', toggleFullscreen);\r\n\r\n// animation layer background image\r\nlet indexImage = 0;\r\nlet timer;\r\n\r\n// define speed of animation layer background image\r\nfunction animationSpeed() {\r\n  if(rangeFPS.value == 0) return;\r\n  let speed = 1000 / rangeFPS.value;\r\n  return speed;\r\n}\r\n\r\nfunction animationBackground() {\r\n  let speed = animationSpeed();\r\n  const framesCanvas = document.querySelectorAll('.canvas2');\r\n  const ctxLayer = layer.getContext('2d');\r\n  ctxLayer.clearRect(0, 0, layer.width, layer.height);\r\n  ctxLayer.drawImage(framesCanvas[indexImage = ++indexImage % framesCanvas.length], 0, 0);\r\n  const canvasTemp = document.querySelectorAll('.canvas-temp');\r\n  for(let i = 0; i < canvasTemp.length; i++) {\r\n    ctxLayer.drawImage(canvasTemp[i], 0, 0);\r\n  }\r\n  if (timer) {\r\n    clearInterval(timer);\r\n  }\r\n  timer = setTimeout(animationBackground, speed);\r\n  if(rangeFPS.value == 0) {\r\n    clearInterval(timer);\r\n  }\r\n}\r\n\r\ncanvas.addEventListener('mouseup', animationBackground);\r\nrangeFPS.addEventListener(\"input\", animationBackground);\r\n\r\n// save image\r\n// change text on input range\r\nconst rangeSize = document.querySelector('.range-size');\r\n\r\nfunction valueImageSize() {\r\n  const sizeValue = document.querySelector('.size-value');\r\n  sizeValue.innerText = rangeSize.value;\r\n  return rangeSize.value;\r\n}\r\n\r\nrangeSize.addEventListener(\"input\", valueImageSize);\r\n\r\n// save image as gif\r\n// https://github.com/yahoo/gifshot\r\n// https://github.com/rndme/download\r\nfunction framesToImages() {\r\n  const canvas2All = document.querySelectorAll('.canvas2');\r\n  const images = [];\r\n  canvas2All.forEach(canvas2 => {\r\n    const canvasIn = document.createElement('canvas');\r\n    const ctxIn = canvasIn.getContext('2d');\r\n\r\n    const size = valueImageSize();\r\n    canvasIn.width = size;\r\n    canvasIn.height = size;\r\n    ctxIn.fillStyle = 'rgba(225,225,225,0.1)';\r\n    ctxIn.fillRect(0, 0, canvasIn.width, canvasIn.height);\r\n    ctxIn.imageSmoothingEnabled = false;\r\n    ctxIn.drawImage(canvas2, 0, 0, size, size);\r\n    images.push(canvasIn.toDataURL());\r\n  });\r\n  return images;\r\n}\r\n\r\nconst saveGif = document.querySelector('.save-gif');\r\nsaveGif.addEventListener('click', () => {\r\n  gifshot.createGIF({\r\n    images: framesToImages(),\r\n    interval: 1 / rangeFPS.value,\r\n    gifWidth: valueImageSize(),\r\n    gifHeight: valueImageSize(),\r\n  }, (obj) => {\r\n    if (!obj.error) {\r\n      const image = obj.image;\r\n      download(image, 'newGif.gif', 'gif');\r\n    }\r\n  });\r\n});\r\n\r\n// save image as apng\r\n// https://github.com/photopea/UPNG.js\r\nfunction ArrayBufferData() {\r\n  const data = [];\r\n  const canvas2All = document.querySelectorAll('.canvas2');\r\n\r\n  canvas2All.forEach(canvas2 => {\r\n    const ctx = canvas2.getContext('2d');\r\n    const canvasIn = document.createElement('canvas');\r\n    const ctxIn = canvasIn.getContext('2d');\r\n\r\n    const size = valueImageSize();\r\n    canvasIn.width = size;\r\n    canvasIn.height = size;\r\n\r\n    ctxIn.imageSmoothingEnabled = false;\r\n    ctxIn.drawImage(canvas2, 0, 0, size, size);\r\n    const partData = ctxIn.getImageData(0, 0, size, size).data.buffer;\r\n    data.push(partData);\r\n  });\r\n  return data;\r\n}\r\n\r\nfunction saveImageAsApng() {\r\n  const arrAnimationSpeed = new Array(ArrayBufferData().length);\r\n  arrAnimationSpeed.fill(animationSpeed());\r\n  const imageData = UPNG.encode(ArrayBufferData(), valueImageSize(), valueImageSize(), 0, arrAnimationSpeed);\r\n  download(imageData, 'newAPNG.apng', 'apng');\r\n}\r\n\r\nconst saveApng = document.querySelector('.save-apng');\r\nsaveApng.addEventListener('click', saveImageAsApng);\r\n\r\n// save image as own format pixel\r\nfunction saveImageAsPixel() {\r\n  const fps = rangeFPS.value;\r\n  const size = canvas.width;\r\n  const frameCount = framesToImages().length;\r\n  const canvasUrl = canvas.toDataURL();\r\n  const canvas2All = document.querySelectorAll('.canvas2');\r\n  let images = \"\";\r\n  for(let i = 0; i < frameCount; i++) {\r\n      const framesUrl = canvas2All[i].toDataURL();\r\n      images += `${framesUrl}, `;\r\n    }\r\n  const pixel = `${fps}, ${size}, ${frameCount}, ${canvasUrl}, ${images}`;\r\n  download(pixel, 'newPixel.pixel', 'pixel');\r\n}\r\nconst savePixel = document.querySelector('.save-pixel');\r\nsavePixel.addEventListener('click', saveImageAsPixel);\r\n\r\n// open local file pixel from computer\r\n// http://qaru.site/questions/57624/how-to-open-a-local-disk-file-with-javascript\r\nfunction readSingleFile(event) {\r\n  const file = event.target.files[0];\r\n  if (!file) return;\r\n  const reader = new FileReader();\r\n  reader.onload = function(event) {\r\n    const contents = event.target.result;\r\n    importPixel(contents);\r\n  };\r\n  reader.readAsText(file);\r\n}\r\n\r\nconst importPixelBtn = document.querySelector('.import-pixel');\r\nimportPixelBtn.addEventListener('change', readSingleFile, false);\r\n\r\n// restore the state of elements from a pixel file\r\nfunction importPixel(contents) {\r\n  const pixelArr = contents.split(', ');\r\n  const saveFps = pixelArr[0];\r\n  const saveSize = pixelArr[1];\r\n  const saveFrameCount = pixelArr[2];\r\n  const saveCanvasUrl = pixelArr[3];\r\n\r\n  rangeFPS.value = saveFps;\r\n  const fpsValue = document.querySelector('.fps-value');\r\n  fpsValue.innerText = saveFps;\r\n\r\n  canvas.width = canvas.height = saveSize;\r\n  canvas2.width = canvas2.height = saveSize;\r\n  layer.width = layer.height = saveSize;\r\n  const resizeInput = document.getElementsByName('resize');\r\n  resizeInput.forEach(input => {\r\n    input.checked = false;\r\n    if(input.value == saveSize) {\r\n      input.checked = true;\r\n    }\r\n  });\r\n\r\n  const saveCanvasImage = new Image();\r\n  saveCanvasImage.src = saveCanvasUrl;\r\n  saveCanvasImage.onload = function() {\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    ctx.drawImage(saveCanvasImage, 0, 0, canvas.width, canvas.height);\r\n    frameCreate();\r\n    animationBackground();\r\n  }\r\n\r\n  if(saveFrameCount > 1) {\r\n    const framesParent = document.querySelector('.previews-list');\r\n\r\n    for(let i = 0; i < saveFrameCount-1; i++) {\r\n      const canvas2 = framesParent.lastElementChild.firstElementChild.firstElementChild;\r\n      const ctx2 = canvas2.getContext('2d');\r\n      const framesImage = new Image();\r\n      framesImage.src = pixelArr[4 + i];\r\n      framesImage.onload = function() {\r\n        ctx2.drawImage(framesImage, 0, 0);\r\n      }\r\n      addFrame();\r\n    }\r\n  }\r\n}\r\n\r\n// import image from computer\r\nfunction importImage(event) {\r\n  const image = event.target.files[0];\r\n  if (!image) return;\r\n  const readerImage = new FileReader();\r\n  readerImage.onload = function(event) {\r\n    const loadImageUrl = event.target.result;\r\n    var loadImage = new Image();\r\n    loadImage.src = loadImageUrl;\r\n    loadImage.onload = function() {\r\n      ctx.imageSmoothingEnabled = false;\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\t  ctx.drawImage(loadImage, 0, 0, canvas.width, canvas.height);\r\n      frameCreate();\r\n      animationBackground();\r\n    };\r\n  };\r\n  readerImage.readAsDataURL(image);\r\n}\r\n\r\nconst importImageBtn = document.querySelector('.import-image');\r\nimportImageBtn.addEventListener('change', importImage, false);\r\n\r\n// save image as png\r\nfunction saveImageAsPng() {\r\n  const canvas2All = document.querySelectorAll('.canvas2');\r\n  const canvasIn = document.createElement('canvas');\r\n    const ctxIn = canvasIn.getContext('2d');\r\n\r\n    const size = valueImageSize();\r\n    canvasIn.width = size;\r\n    canvasIn.height = size;\r\n\r\n    ctxIn.imageSmoothingEnabled = false;\r\n\r\n  canvas2All.forEach(canvas2 => {\r\n    ctxIn.drawImage(canvas2, 0, 0, size, size);\r\n  });\r\n  const image = canvasIn.toDataURL();\r\n  download(image, 'newPng.png', 'png');\r\n}\r\n\r\nconst savePng = document.querySelector('.save-png');\r\nsavePng.addEventListener('click', saveImageAsPng);\r\n\r\n// upload image to Google Drive\r\nconst saveToGoogleDrive = (fileContent) => {\r\n  const arrAnimationSpeed = new Array(ArrayBufferData().length);\r\n  arrAnimationSpeed.fill(animationSpeed());\r\n  const imageData = UPNG.encode(ArrayBufferData(), valueImageSize(), valueImageSize(), 0, arrAnimationSpeed);\r\n\r\n  var file = new Blob([imageData], { type: 'image/apng' });\r\n  var metadata = {\r\n    'name': 'newPiskel.apng',\r\n    'mimeType': 'apng',\r\n  };\r\n  var accessToken = window.gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;\r\n  var form = new FormData();\r\n  form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));\r\n  form.append('file', file);\r\n  fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {\r\n    name: 'piskel.jpg',\r\n    method: 'POST',\r\n    headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),\r\n    body: form,\r\n  });\r\n}\r\n\r\nconst btnSaveGoogle = document.querySelector('.save-google-drive');\r\nbtnSaveGoogle.addEventListener('click', saveToGoogleDrive);\r\n\r\n// save the state of elements in LocalStorage\r\nconst tool = document.getElementsByName('tool');\r\nfor (let i = 0; i < tool.length; i++) {\r\n  tool[i].onclick = function() {\r\n    localStorage.setItem('radioTool', this.value);\r\n  }\r\n}\r\n\r\nconst resize = document.getElementsByName('resize');\r\nfor (let i = 0; i < resize.length; i++) {\r\n  resize[i].onclick = function() {\r\n    localStorage.setItem('radioResize', this.value);\r\n  }\r\n}\r\n\r\nactiveColor.onchange = function() {\r\n    localStorage.setItem('activeColor', activeColor.value);\r\n  }\r\nprevColor.onchange = function() {\r\n    localStorage.setItem('prevColor', prevColor.value);\r\n  }\r\n\r\ncanvas.onclick = function() {\r\n  const url = canvas.toDataURL();\r\n  localStorage.setItem('url', url);\r\n}\r\n\r\nfunction saveFrames() {\r\n  const canvas2All = document.querySelectorAll('.canvas2');\r\n  const framesLength = canvas2All.length;\r\n  localStorage.setItem('framesLength', framesLength);\r\n\r\n  for(let i = 0; i < framesLength; i++) {\r\n      const framesUrl = canvas2All[i].toDataURL();\r\n      localStorage.setItem(i, framesUrl);\r\n    }\r\n}\r\n\r\naddFrameButton.addEventListener(\"click\", saveFrames);\r\nparent.addEventListener(\"click\", saveFrames);\r\n\r\n// restore the state of elements after a reboot\r\nwindow.onload = function() {\r\n  if(localStorage.getItem('radioTool')) {\r\n    const radioTool = localStorage.getItem('radioTool');\r\n    document.querySelector('input[name=\"tool\"][value=\"' + radioTool + '\"]').setAttribute('checked','checked');\r\n  }\r\n\r\n  if(localStorage.getItem('radioResize')) {\r\n    const radioResize = localStorage.getItem('radioResize');\r\n    document.querySelector('input[name=\"resize\"][value=\"' + radioResize + '\"]').setAttribute('checked','checked');\r\n    setSizeCanvas();\r\n  }\r\n\r\n  if(localStorage.getItem('activeColor')) {\r\n    activeColor.value = localStorage.getItem('activeColor');\r\n  }\r\n  if(localStorage.getItem('prevColor')) {\r\n    prevColor.value = localStorage.getItem('prevColor');\r\n  }\r\n\r\n  if(localStorage.getItem('url')) {\r\n    const savedImage = new Image();\r\n    savedImage.src = localStorage.getItem('url');\r\n    savedImage.onload = function() {\r\n      ctx.drawImage(savedImage, 0, 0);\r\n      frameCreate();\r\n      animationBackground();\r\n    }\r\n  }\r\n\r\n    if(localStorage.getItem('framesLength')) {\r\n    const framesLength = localStorage.getItem('framesLength');\r\n    const framesParent = document.querySelector('.previews-list');\r\n\r\n    for(let i = 0; i < framesLength-1; i++) {\r\n      const canvas2 = framesParent.lastElementChild.firstElementChild.firstElementChild;\r\n      const ctx2 = canvas2.getContext('2d');\r\n      const framesImage = new Image();\r\n      framesImage.src = localStorage.getItem(i);\r\n      framesImage.onload = function() {\r\n        ctx2.drawImage(framesImage, 0, 0);\r\n      }\r\n      addFrame();\r\n    }\r\n  }\r\n}\r\n\r\n// clear localStorage\r\nconst btnCreate = document.querySelector('.btn-create');\r\nbtnCreate.onclick = function() {\r\n  localStorage.clear();\r\n}\r\n\r\nconst newPiskel = document.querySelector('.name');\r\nnewPiskel.onclick = function() {\r\n  localStorage.clear();\r\n  while (parent.children.length > 1) {\r\n    parent.removeChild(parent.lastChild);     \r\n  }\r\n  parent.firstElementChild.firstElementChild.classList.add('preview-active');\r\n  const canvas2 = document.querySelector('.canvas2');\r\n  const ctx2 = canvas2.getContext('2d');\r\n  ctx2.clearRect(0, 0, canvas.width, canvas.height);\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  const ctxLayer = layer.getContext('2d');\r\n  ctxLayer.clearRect(0, 0, layer.width, layer.height);\r\n  activeColor.value = '#006060';\r\n  prevColor.value = '#ffd700';\r\n}\r\n\r\n// restore the state of elements from a piskel file\r\nfunction readPiskelFile(event) {\r\n  const file = event.target.files[0];\r\n  if (!file) return;\r\n  const reader = new FileReader();\r\n  reader.onload = function(event) {\r\n    const contents = event.target.result;\r\n    importDataFromPiskel(contents);\r\n  };\r\n  reader.readAsText(file);\r\n}\r\n\r\nfunction importDataFromPiskel(contents) {\r\n  const fps = contents.split('fps\":').pop().split(',')[0];\r\n  const size = contents.split('height\":').pop().split(',')[0];\r\n  const frameCount = contents.split('frameCount\\\\\":').pop().split(',')[0];\r\n  const imageUrl = contents.split('base64PNG\\\\\":\\\\\"').pop().split('\\\\\"')[0];\r\n\r\n  rangeFPS.value = fps;\r\n  const fpsValue = document.querySelector('.fps-value');\r\n  fpsValue.innerText = fps;\r\n\r\n  canvas.width = canvas.height = size;\r\n  canvas2.width = canvas2.height = size;\r\n  layer.width = layer.height = size;\r\n  const resizeInput = document.getElementsByName('resize');\r\n  resizeInput.forEach(input => {\r\n    input.checked = false;\r\n    if(input.value == size) {\r\n      input.checked = true;\r\n    }\r\n  });\r\n\r\n  const saveCanvasImage = new Image();\r\n  saveCanvasImage.src = imageUrl;\r\n  saveCanvasImage.onload = function() {\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    ctx.drawImage(saveCanvasImage, size * (frameCount - 1), 0, size, size, 0, 0, size, size);\r\n    frameCreate();\r\n    animationBackground();\r\n  }\r\n\r\n    if(frameCount > 1) {\r\n    const framesParent = document.querySelector('.previews-list');\r\n\r\n    for(let i = 0; i < frameCount-1; i++) {\r\n      const canvas2 = framesParent.lastElementChild.firstElementChild.firstElementChild;\r\n      const ctx2 = canvas2.getContext('2d');\r\n      const framesImage = new Image();\r\n      framesImage.src = imageUrl;\r\n      framesImage.onload = function() {\r\n        ctx2.drawImage(saveCanvasImage, size * i, 0, size, size, 0, 0, size, size);\r\n      }\r\n      addFrame();\r\n    }\r\n  }\r\n}\r\n\r\nconst importPiskelBtn = document.querySelector('.import-piskel');\r\nimportPiskelBtn.addEventListener('change', readPiskelFile, false);\r\n\r\n// save image as piskel\r\nfunction saveImageAsPiskel() {\r\n  const fps = rangeFPS.value;\r\n  const height = canvas.height;\r\n  const width = canvas.width;\r\n  const frameCount = framesToImages().length;\r\n\r\n  const canvas2All = document.querySelectorAll('.canvas2');\r\n\r\n  const canvasIn = document.createElement('canvas');\r\n  const ctxIn = canvasIn.getContext('2d');\r\n  canvasIn.width = frameCount * width;\r\n  canvasIn.height = height;\r\n\r\n  canvas2All.forEach((canvas2, index) => {\r\n    ctxIn.drawImage(canvas2, width * index, 0, width, height);\r\n  });\r\n  const images = canvasIn.toDataURL('image/png;base64');\r\n\r\n  let layout = '';\r\n\r\n  for(let i = 0; i < frameCount; i++) {\r\n    layout += '[' + i + '],';\r\n  }\r\n\r\n  const piskel = `{\"modelVersion\":2,\"piskel\":{\"name\":\"New Piskel\",\"description\":\"\",\"fps\":${fps},\"height\":${height},\"width\":${width},\"layers\":[\"{\\\\\"name\\\\\":\\\\\"Layer 1\\\\\",\\\\\"opacity\\\\\":1,\\\\\"frameCount\\\\\":${frameCount},\\\\\"chunks\\\\\":[{\\\\\"layout\\\\\":[${layout.slice(0, -1)}],\\\\\"base64PNG\\\\\":\\\\\"${images}\\\\\"}]}\"],\"hiddenFrames\":[]}}`\r\n  download(piskel, 'newPiskel.piskel', 'piskel');\r\n}\r\n\r\nconst savePiskel = document.querySelector('.savepiskel');\r\nsavePiskel.addEventListener('click', saveImageAsPiskel);\r\n"],"sourceRoot":""}